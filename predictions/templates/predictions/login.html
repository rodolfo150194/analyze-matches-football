{% extends "predictions/auth_base.html" %}

{% block title %}Login - Football Analytics{% endblock %}

{% block subtitle %}Sign in to access predictions{% endblock %}

{% block content %}
    <!-- Display messages -->
    {% if messages %}
        {% for message in messages %}
            <div class="alert alert-{{ message.tags }}" role="alert">
                {{ message }}
            </div>
        {% endfor %}
    {% endif %}

    <!-- Display form errors -->
    {% if form.non_field_errors %}
        <div class="alert alert-danger" role="alert">
            {% for error in form.non_field_errors %}
                {{ error }}
            {% endfor %}
        </div>
    {% endif %}

    <form method="post" action="{% url 'predictions:login' %}" id="loginForm">
        {% csrf_token %}

        <!-- Username/Email Field -->
        <div class="mb-4">
            <label for="id_username" class="form-label">Username or Email</label>
            <input
                type="text"
                class="form-control {% if form.username.errors %}is-invalid{% endif %}"
                id="id_username"
                name="username"
                placeholder="Enter your username or email"
                value="{{ form.username.value|default:'' }}"
                required
                autofocus
            >
            {% if form.username.errors %}
                <div class="invalid-feedback d-block">
                    {% for error in form.username.errors %}
                        {{ error }}
                    {% endfor %}
                </div>
            {% endif %}
        </div>

        <!-- Password Field -->
        <div class="mb-4">
            <label for="id_password" class="form-label">Password</label>
            <input
                type="password"
                class="form-control {% if form.password.errors %}is-invalid{% endif %}"
                id="id_password"
                name="password"
                placeholder="Enter your password"
                required
            >
            {% if form.password.errors %}
                <div class="invalid-feedback d-block">
                    {% for error in form.password.errors %}
                        {{ error }}
                    {% endfor %}
                </div>
            {% endif %}
        </div>

        <!-- Remember Me & Forgot Password -->
        <div class="mb-4 d-flex justify-content-between align-items-center">
            <div class="form-check">
                <input
                    class="form-check-input"
                    type="checkbox"
                    id="rememberMe"
                    name="remember_me"
                >
                <label class="form-check-label" for="rememberMe">
                    Remember me
                </label>
            </div>
            <a href="#" class="btn-link">Forgot password?</a>
        </div>

        <!-- Submit Button -->
        <button type="submit" class="btn btn-primary mb-3">
            Sign In
        </button>

        <!-- Redirect to matches if 'next' parameter exists -->
        {% if next %}
            <input type="hidden" name="next" value="{{ next }}">
        {% endif %}
    </form>

    <!-- Footer -->
    <div class="auth-footer">
        <p>Don't have an account?</p>
        <a href="{% url 'predictions:register' %}" class="btn-link">Create an account</a>
    </div>
{% endblock %}

{% block extra_js %}
<script>
    // Add subtle form interaction animations
    document.addEventListener('DOMContentLoaded', function() {
        const inputs = document.querySelectorAll('.form-control');

        inputs.forEach(input => {
            input.addEventListener('focus', function() {
                this.parentElement.style.transform = 'translateX(0)';
            });

            input.addEventListener('blur', function() {
                if (!this.value) {
                    this.parentElement.style.transform = '';
                }
            });
        });

        // Form validation on submit
        const form = document.getElementById('loginForm');
        form.addEventListener('submit', function(e) {
            const username = document.getElementById('id_username');
            const password = document.getElementById('id_password');

            let isValid = true;

            // Reset validation states
            username.classList.remove('is-invalid');
            password.classList.remove('is-invalid');

            // Validate username
            if (!username.value.trim()) {
                username.classList.add('is-invalid');
                isValid = false;
            }

            // Validate password
            if (!password.value) {
                password.classList.add('is-invalid');
                isValid = false;
            }

            if (!isValid) {
                e.preventDefault();
            }
        });
    });
</script>
{% endblock %}
